# 网际协议IP（Internet Protocal）
网际协议IP是TCP/IP中最重要的两个协议之一。其作用是：使互连起来的许多计算机网络能够互相通信，因此TCP/IP体系中的网络层也被称为网际层。

首先明确一点：IP协议是不可靠协议，也就是说IP协议不提供数据传送出现差错时的处理机制，这些是其上层协议要做的事。

# 虚拟互连网络
在了解IP之前必须要先学习**虚拟互连网络**。

全世界范围内有非常多的网络，这些网络形态各异，如果想要让他们能够互连起来，并且使之可以通信，那么任务和需要解决的问题是非常巨大和复杂的。

而要使得不同的网络能够互连起来就需要使用一些**中间设备**，这些中间设备可以根据不同层次进行划分：
+ 转发器：物理层使用的中间设备；
+ 网桥：数据链路层使用的中间设备，也叫桥接器；
+ 路由器：网络层使用的中间设备；
+ 网关：在网络层以上的层次使用的中间设备。用网关连接两个不兼容的系统需要在高层中进行协议的转换。

> 在使用网桥或转发器时，仅仅是将一个网络扩大了，本质还是同一个网络，而网关比较复杂，现在使用较少。因此现在在讨论网络互连时，都是指的用**路由器**进行`网络互连`和`路由选择`。
>> 路由器其实就是专用计算机，用来在互联网中进行路由选择。

将众多的网络通过IP协议进行互连，就可以将本来各种物理网络的异构性的网络组网络层上看起来好像是一个统一的网络。这种网络就是逻辑互连网络，就是虚拟互连网络。这种使用IP协议的虚拟互联网简称为IP网（所以IP网是虚拟的）。

最终结果就是，不同网络的主机进行通信时，好像在单个网络上通信一样。看不到具体的异构细节。比如：编址方案，路由选择协议等。
> 如果在这种覆盖全球的IP网的上层使用TCP协议，就是现在的互联网。

## 两台主机之间的通信
比如，两台主机H1、H2现在要进行通信，其详细过程如下：
1.  H1检查自己的路由表，看目的主机是否就在本网络上。如果在则直接交付，否则把IP数据包发送给某个路由器。
2.  这个路由器在收到IP数据包之后，同样查看自己的路由表（书上说转发表更准确），找到自己应该将次IP数据包交付给对应的路由器。
3.  这个对应的路由同样也重复上述操作，，直到找到跟目的主机H2在同一网络的某个路由器。
4.  最后的路由器在检查路由表的时候就知道，不需要再使用别的路由器转发了。于是将IP数据报直接交付给目的主机H2即可。
> 主机的协议栈有5层，路由器只有3层。

# IP地址
在物理层中，一般通过`MAC地址`来识别不同的结点，在网络层中对应的地址标识就是`IP地址`。IP地址是给互联网上的每一台主机的每一个接口分配一个全世界独一无二的*32位标识符*。下面只说`分类的IP地址`。

所谓分类的IP地址就是将IP地址划分为若干个固定的类。每一类地址都由两个固定长度的字段组成：
+ 网络号：net-id 他是主机或路由器所连接到的网络的标识，互联网中的每个网络标识必须唯一；
+ 主机号：host-id 标志该主机或路由器。一台主机号在它前面的网络号所指明的网络范围内也必须是唯一的。
> 由此可见，IP地址在整个互联网范围内一定是唯一的。而且它指明了主机和主机所连接到的网络。

对于主机和路由器来说，IP地址都是32位常的二进制代码，为了方便阅读，将这32位代码8个一组，分为四组，每组转换为10进制后，在其之间用 . 间隔，这种表示法叫作：**点分十进制记法**。

## 三种常用的IP地址
A类：
+ net-id：A类IP地址的网络号字段占**1byte**，不过第1位固定为0，所以可变的只有7位。所以A类地址的网络号可指派的个数为：2^7?<br />No。因为网络号字段全为0是具有特殊意义的保留地址，意为：**本网络**。<br />还有，网络号字段的后7位全为1，也是一个保留地址，作为本地软件环回测试。（本主机的进程之间的通信所用）。所以可指派的网络号个数为`2^7 - 2`
> 0.0.0.0就是本机，127.*.*.*本机进程通信所用。目的地址为环回地址时，IP数据报不会被发送到任何网络，因为127就不是一个网络号。
+ host-id：主机号字段占**3byte**，同样的，它可以指派的主机号也不是简单的2^24，而是`2^24 - 2`。<br>主机号全为0，保留为本主机所连接到的单个网络地址。（举个例子，IP为1.2.3.4连接到的网络地址就是1.0.0.0）<br>而全为1，保留为连接到本网络的所有主机。
> A类所占的所有IP地址个数为 `2^7 * 2^24 = 2^31`,占所有IP地址的`50%`。

B类：
+ net-id：网络号占**2byte**,前两位已经确定为10，还有14位。期中128.0.0.0也是不指派的，所以其最小可指派的网络地址为128.1.0.0，所以B类的可指派网络号有`2^14 - 1`。
+ host-id：有**2byte**和A类一样，全0个全1被保留，所以可指派的主机号有：`2^16 - 2`
> 整个B类有`2^14 * 2^16 = 2^30`个地址，占全部的`25%`。

C类：
+ net-id：网络号占**3byte**，前面三位确定为110，2^21 - 1,192.0.0.0是不指派的。
+ host-id：有**1byte**，和上面一样全0全1干掉之后，可指派个数为：`2^8 - 2`
> 整个C类有`2^21 * 2^8 = 2^29`，占全体的`12.5%`。

> 总结上面的规律，net-id的可指派的位全为0时是不指派的。host-id 的全0和全1都是保留的。

## IP地址的特点
+ IP地址是一种分等级的地址结构，它有以下好处：
  1.  IP地址管理机构在分配IP地址的时候只分配网络号即可，剩下的网络号单位自行分配。
  2.  路由器仅根据网络号来转发分组，这样可以使得项目数大幅减少，减少了所需资源，提升的速度。
+ IP地址是标志一台主机和一条链路的接口。当一台主机同时连接到两个网络时，则必定有两个不同的IP地址，其网络号必定不同。称之为：**多归属主机**。
+ 按照互联网的观点，一个网络指的是具有相同网络号的主机的集合，因此使用转发器、网桥连接起来的若干局域网仍然是一个网络。
+ 互联网会同等对待每一个IP地址。
+ 路由器总是有两个及以上的IP地址，即路由器的每个接口都有不同的网络号的IP地址。
+ 两个路由器直接相连的时候，连线的两端可以分配IP也可以不分配。如果分配了，则这段连线就构成了只包含一段连线的`特殊“网络”`。如果没有分配IP，则称这种特殊的网络为**无名网络**或无**编号网络**。