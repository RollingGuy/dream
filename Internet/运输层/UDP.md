# UDP 的特点

主要特点：

- 无连接：发送数据之前不需要建立连接（断开时自然也就不需要断开连接了），因此十分高效。
- 面向报文：发送方的`UDP`在接受到应用程序交付的报文后，添加`UDP`首部后直接交付给`IP`层，不做其他任何事。也就是说`UDP`对上层报文既不进行拆分，也不进行合并，而是保留这些报文的边界。至于长度是否过长、过短，这些工作都交付给`IP`层去完成。
- 不可靠：和`TCP`不同，`UDP`只尽最大努力的交付，不保证数据的可靠性。主机不需要维持复杂的连接状态。

> `UDP`只在 IP 上添加了复用和分用以及差错检测。

其他特点：

- 没有拥塞控制：网络出现拥塞`UDP`也不会减缓发送数据的速率。（不过这样反而会引发严重的拥塞问题，因为很多主机同时发送高速率的数据`bit stream`时，大家都无法正常接收 进一步地加重了拥塞）
- 支持`n`对`m`的交互通信`(n,m >= 1)`
- 首部开销小，`8byte`

> 因为`UDP`不对应用程序交付的报文进行处理，所以报文的长度一定要由应用程序来决定。如果过长则 IP 层会分片降低效率，反之 IP 层首部相对较大依然会降低效率。所以应用程序最好能做到在不分片的前提下，令报文尽可能的长一些。

# UDP 的首部

`UDP`用户数据报有两个字段：

1.  首部字段
2.  数据字段

首部字段又由 4 部分组成，每部分 2byte。共 8byte：

1.  源端口
2.  目的端口
3.  长度（总长度，包括数据部分）
4.  检验和

# UDP 的差错检测方式

## 伪首部

首先先介绍一下在差错检测过程中用到的一个叫做**伪首部**的东西：<br>
它只是用于计算`检验和`字段，既不向上提交 也不向下交付。

伪首部共`12byte`：

- 源 IP：`4byte`
- 目的 IP：`4byte`
- 全 0：`1byte`
- 运输层协议的协议号（UDP 是 17）：`2byte`
- UDP 报文长度：`2byte`

## 检验过程

发送方：

1.  将伪首部添加到`UDP`报文的前面
2.  将全 0 放入`UDP`首部的检验和字段
3.  如果数据部分是奇数个字节，则补`1byte`的全 0
4.  将`UDP`报文（包括伪首部）看做是多个 2byte 组成的串，每个串取反相加得结果`sum`
5.  将`sum`取反放入检验和字段中

接收方：

1. 将接收到的`UDP`报文添加上伪首部
2. 如果数据部分是奇数个字节，补`1byte`0
3. 将`UDP`报文（包括伪首部）看做是多个`2byte`组成的串，每个串取反相加得结果`sum`
4. 如果`sum`为全 1，则报文无误交付给应用程序，反之丢弃。（也可以交付给应用程序，但是需要差错提醒）

## 为什么这样可以检测？

发送方得出的结果，跟接收方得出的结果相差的就是 检验和字段中的值。而检验和的值就是 其他部分和的反码。一个数和自己反码的和为 1，则说明这个数没变，否则出现差错。（原理很简单嘛）

> 这种差错检测方式能力并不强，但是处理简单 速度快。
