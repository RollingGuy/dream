# 运输层先导知识
+ 全双工：可以同时(瞬时)进行信号的双向传输；
+ OSI：开放式系统互联(通信参考模型)；
+ TPDU(运输协议数据单元）:两个对等运输实体在通信时传送的数据单元；

# 运输层协议概述
## 进程之间的通信
从通信和信息处理的角度看，`运输层`向它上面的`应用层`提供通信服务。它属于面向通信部分的最高层，用户功能中的最底层。

> 只有主机的协议栈才有运输层，在网络核心部分中的路由器在转发分组时都只用到下三层的功能。

从IP层来说，通信的两端都是主机，IP数据包首部明确的标志了这两台主机的IP地址。

而在运输层，真正通信的实体是主机中的进程，是主机中的某个进程和另一台主机中的进程在交换数据。也就是说两台主机通信，实质上是主机中的进程在通信。

IP协议只能把分组送到目的主机，但是这个分组没有交付到主机中的应用程序中，传输层的任务就是将IP的分组交付到主机中的进程中。

> 总而言之就是`网络层`提供`主机之间的逻辑通信`，`运输层`为`应用进程之间提供端到端的逻辑通信`。
### 复用和分用
+ 复用：发送方的不同进程都可以使用同一个运输层协议传输数据。
+ 分用：指接收方的运输层在剥去报文首部后能够把这些数据正确交付目的进程。

> 应用层所有的应用进程都可以通过运输层在传送到IP层，这就是复用；运输层从IP层收到发送给各应用进程的数据后，必须分别交付指明的各应用进程，这就是分用。

## 运输层的端口
举个栗子：

在我们给人写信的时候，要写明`收信人的地址`，这相当于`主机的IP地址`。但是`同一地址`可能居住着`不同的人`，这相当于`同一台主机`运行着`不同的进程`。在要取信的时候，还需要知道是具体哪个人的信，即`名字`。所以除了IP地址以外，又在运输层使用`协议端口号`，简称端口。

> 这种在协议栈层间的协议端口是软件端口，和路由器或者交换机上的硬件端口是完全不同的概念。而且协议端口只是同一主机内有意义，不同主机的相同端口是没有关系的。

`UDP`和`TCP`的首部中都有`源端口`和`目的端口`这两个重要字段。

`TCP/IP`的运输层用一个`16bit`的端口号来标志一个端口，所以 允许有`65535`个不同的端口号。

> 所以，两个主机中的进程要互相通信，不仅补习知道对方的IP地址，还要知道端口号。而且互联网上的计算机通信采用的都是`CS`模型，`client`在发起通信请求时必须先知道`Server`上的`IP和port`。

### 服务器使用的端口号
分为两类：
+ 熟知端口号
+ 登记端口号

#### 熟知端口号
又叫做系统端口号，数值为0~1023.IANA把这些端口指派给了TCP/IP中最重要的一些应用程序，让所有的用户都知道。

应用程序|HTTP|HTTPS|FTP|DNS
-|-|-|-|-
port|80|443|21|53

#### 登记端口号
数值为：1024~49151.为没有数值端口的应用程序准备的，使用这类端口必须。

## 客户端使用的端口号
数值为49152~65535，这种端口号在客户端进程运行时动态选择，又叫短暂端口号。

通信结束后刚才使用的客户端口号就不存在了，这个端口就可以供其他客户端进程使用。