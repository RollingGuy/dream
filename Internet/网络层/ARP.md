# 地址解析协议ARP
实际应用中，经常遇到：已知一个主机（或路由器）的IP地址，需要知道其相应的硬件地址。ARP就是解决这个问题的。
> 硬件地址和IP地址不存在映射关系。

# ARP高速缓存
主机中都有ARP高速缓存 ARP Cache，其中存放一个从IP地址到硬件地址的映射表，并且它会动态更新，新增、超时删除等。

当主机A要向**本局域网**的某台主机B发送ip数据报时，就先在ARP Cache中查看是否有B的ip地址，如果有则直接就可得出对应的硬件地址，然后通过局域网把对应的MAC帧发送到这个硬件地址即可。

如果查不到，则主机会运行ARP，找出B的硬件地址：
1.  ARP进程在本局域网上广播一个ARP请求分组，分组的主要内容意思就是：我的ip、硬件地址是多少，我想知道ip为x的硬件地址
2.  在本局域网上所有主机上运行的ARP进程都会收到这个请求分组
3.  如果某个主机的ip地址就是请求分组中给出的ip，则收下ARP请求分组，并向A发送ARP响应分组，在这个分组中写入自己的物理地址。
4.  其他主机因为自己的ip跟请求分组中的ip不同，直接丢弃这个ARP请求分组即可
5. 得到B的物理地址后，A就将其写入ARP cache中。（B也会把A的ip-物理地址写入自己的ARP cache中）。
> 这样就得到了B的物理地址，不过ARP只能得出同一局域网的。ARP请求分组是广播发送的，但是ARP响应分组是普通的单播。

ARP仅仅是解决在同一局域网上的主机或路由器的IP和硬件地址的映射问题。ARP对保存在高速缓存中的映射都会设置生存时间，超过生存时间的item会从缓存中干掉，这保证了ARP不会因为某个主机硬件地址的改变而无法和其通信的问题。

# ARP解析硬件地址全过程

1.  h1要将ip数据报发送到同一个网络的另一台主机h2。h1发送ARP请求分组得到h2的物理地址。
2.  h1要将ip数据报发送到不同网络的h3.这时h1发送ARP请求，找到当前网络的一个router1，然后把数据发送给router1
3.  router1如果发现h3跟自己在同一个局域网，则通过ARP请求得到其MAC地址，然后发送。
4.  否则，router1找到下一个网络的一个router2，把数据交给router2
5.  router2重复上述工作，直到某个router跟h3在同一个网络，交付到h3即可。
