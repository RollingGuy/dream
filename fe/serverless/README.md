## 什么是 serverless

`Serverless` 并不是某种技术，或者某种技术的具体实现。而是一种后端的架构设计理念，好比 `RESTFul` 之于 `HTTP` ， `serverless` 对于后端架构来说只是一种设计的理念、思路。

这种理念带来的好处是，对于业务开发者来说，不需要关系 `server` 层的东西，只需要专注于业务层面的逻辑即可。

虽然目前没有严格的 `serverless` 规范，但是大多数 `serverless` 方案都由两部分组成：

- FaaS: 部署单位不再以应用为单位，而是以函数的形式进行部署
- BaaS: DB,Redis,MQ 等资源直接使用云端资源，不需要自己搭建

### 优点

无需管理 `server` 等基础设施，只需要编写 `code` 和选择`trigger` 并且上传。剩下的工作（实例选择、 扩缩容、部署、容灾、监控、日志、安全补丁等）全部由`serverless` 系统托管。 用户只需要为代码实际运行消耗的资源付费，代码没有运行不产生费用。

### 缺点

## FaaS

- 状态管理方面：对于有状态的服务，需要和存储交互（BaaS），不可避免的增加了延迟和复杂性、耦合性。而要自由的缩放，无状态又是必须的，所以对于 `stateful` 服务不适合 `serverless`
- 硬件方面：因为不关心机器的硬件，所以对硬件（GPU）敏感的应用也并不适合。

因为不直接参与服务的编排，所以 `FaaS` 都是 `stateless` 。所以需要使用 `DB/Redis` 来存储中间状态，这会带来性能上的开销。因此对于性能高度敏感的应用是不适合 `serverless` 的。

`serverless` 相对于 `serverful`,对于业务方强调 `noserver` ，意思只是说业务人员无须关注 `server` 。业务人员只需要聚焦于业务逻辑代码。

## 函数实例

为了确保隔离，每个函数实例都会有一个单独的容器。包括：

- 编程语言运行环境
- 内置模块
- FaaS 依赖
- 函数代码

## 启动

### 冷启动

- 下载代码: 为了能够缩容到 0, FaaS 本身不会存储代码. 最终代码会被放到存储服务中, 在启动过程中会从存储服务获取代码
- 启动容器: 下载完成后根据配置启动对应容器
- 初始化运行环境: 执行初始化逻辑
- 运行代码: 调用. 可能是冷启动也肯呢个是热启动

> 简单理解就是用完即销毁

### 热启动

- 常驻内存: 如果长时间没有事件触发，实例还是会被销毁的

### 启动时长

不同编程语言的冷启动时长是不同的。

可以看到，Node 在冷启动方面是比较有优势的，这也是为什么 FaaS 即使支持的语言较少也会支持 Nodejs 的原因。

正因为 Node 能够短时间完成冷启动，FaaS 才敢缩容到 0.

## 性能优化

@TODO

## 总结

- IaaS，Ifrastructure as a service
- PaaS, Platform as a service
- BaaS, Backend as a service
- FaaS, Function as a service
