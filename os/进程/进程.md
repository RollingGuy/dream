# 写在前面的话

long long ago `未配置OS的系统`和`单道批处理系统`中，程序的执行方式是顺序执行，也就是内存中只装入一道用户程序，独占系统资源，只有在一个用户程序执行完毕后下一个程序才能被装入执行。这种方式浪费资源，系统运行效率低。

后来，多道程序系统中内存可以同时装入多个程序，他们共享系统资源、并发执行，可以克服上面的缺点。

> 程序的两种执行方式有着显著不同的特点，尤其考虑到程序的并发执行，于是 OS 中引入了`进程`的概念。

# 程序的执行

程序顺序执行的特征:

- 1.顺序性
- 2.封闭性
- 3.可再现性

程序的并发执行的特征:

1. 间断性
2. 失去封闭性
3. 不可再现性

> 并非所有的程序都能够并发执行，只有在`不存在前驱关系`的程序之间才有可能并发执行。

# 进程的描述

## 进程的定义

为了使参加并发执行的程序都能够独立的运行，在`OS`中必须为之配置一个专门的数据结构————**进程控制块**(`Process Control Block, PCB`)。利用`PCB`来描述进程的基本情况和活动过程，进而控制和管理进程。

由`程序段、相关数据段和PCB`三部分构成了`进程实体`（又称为进程映像）。一般情况下，进程实体简称为进程。例如：创建进程实质上是创建进程实体中的 PCB，撤销进程实质上是撤销进程实体的 PCB。

**定义**：进程是进程实体的运行过程，是系统进行资源分配和调度的一个独立单位。

> 简单理解，进程就是执行的程序。

## 进程的特征

1. 动态性：进程的实质是进程实体的执行过程，所以程序是静态的，进程是动态的；
2. 并发性：多个进程实体同存于内存中，可以并发执行。程序是没有 PCB 的，所以不能参与并发执行。
3. 独立性：进程实体是能够独立运行、独立获得资源、独立接受调度的基本单位。未建立 PCB 的程序都不能作为一个独立的单位参与运行。
4. 异步性：即进程按照各自独立的、不可预知的速度向前推进。而传统意义上的程序如果参与并发执行，结果会不可再现。而进程虽然具有异步性，但是在配置相应的进程同步机制后，仍然能够保证并发执行的结果是可再现的。

# 进程的状态及转换

## 进程的三种基本状态

1. 就绪状态(Ready):进程依分配到除 CPU 以外的所有必要资源，只要再获得 CPU 便可立即执行。如果系统中有许多处于就绪状态的进程，通常将他们按照一定的策略排成一个队列，也就是`就绪队列`。
2. 执行状态(Running):进程已经获得 CPU，其程序正在执行。在单处理机系统中只能有一个进程处于 Running，对于多处理机系统而言可以有多个进程处于此状态。
3. 阻塞状态(Block):正在执行的进程由于发生某事件(比如 I/O 请求、申请缓冲区失败)无法继续执行。此时引起进程调度，OS 将处理机分配给另一个就绪进程，将受阻进程处于暂停状态，阻塞状态的进程也会被排成一个队列，成为`阻塞队列`。在较大的系统中，对于不同的阻塞原因，会设置多个不同的阻塞队列。此状态又称为`等待状态`或`封锁状态`。

## 三种基本状态的转换

![](https://user-gold-cdn.xitu.io/2018/11/17/1672099b4aaa8d9f?w=743&h=499&f=png&s=31857)

## 创建状态和终止状态

### 创建状态

1. 首先由进程申请一个空白 PCB，并向 PCB 中填写用于控制和管理进程的信息；
2. 然后为该进程分配运行时所必须的资源；
3. 最后将该进程转入就绪状态并插入就绪队列之中。

但是如果进程所需的组员尚不能得到满足，比如系统没有足够的内存，此时创建工作尚未完成，进程不能被调度执行，将进程此时所处的状态称为`创建状态`。

### 终止状态

进程的终止也是需要一个过程的：

1. 等待 OS 进行善后处理
2. 将 PCB 清零，将 PCB 空间返还系统。

如果一个进程到达了自然结束点，或者出现了无法克服的错误，要么被 OS 终结，要么被其他有终止权的进程终结，它将进入`终止状态`。

> 终止状态的进程不能再执行，但是 OS 中依然保留一个记录，其中保存`状态码`和一些`计时统计数据`供其他进程收集。一旦完成对其信息的提取，OS 将删除该进程。即将 PCB 清零，将空白 PCB 返回系统。

![](https://user-gold-cdn.xitu.io/2018/11/17/16720b5da4168e25?w=814&h=498&f=png&s=38732)

## 挂起和进程状态的转换

在许多 OS 种除了就绪执行和阻塞三种最基本的状态以外呢，为了系统和用户观察和进程的需要，还引入了一个对进程的重要操作————挂起。

某个进程被挂起时，该进程处于静止状态，如果该进程正在执行，则暂停执行，若原本就处于就绪状态，则该进程暂不接受调度。与`挂起`对应的是`激活`。

### 挂起操作的引入

引入挂起的原因呢，如下所示：

1. 终端用户的需要：有的用户需要暂停自己的程序，以便研究其执行情况，对程序进行修改。
2. 父进程请求：有事父进程希望挂起某个子进程，以便查看和修改子进程或者协调子进程间的活动。
3. 负荷调节的需要：当时候是 OS 的工作负荷较重时，会把一些不重要的进程挂起。
4. OS 的需要：OS 有时需要挂起某些进程，以便检查运行中的资源使用情况或进行记账。

### 引入挂起操作后三个进程状态的转换

1. 活动就绪=>静止就绪
2. 活动阻塞=>静止阻塞
3. 静止就绪=>活动就绪
4. 静止阻塞=>活动阻塞

## 进程管理中的数据结构

为了便于计算机中的各类资源的使用和管理，OS 将它们抽象为相应的各种数据结构，以及提供一组对资源进行操作的命令，无需关系具体细节就可以对各种资源进行操作。

另外，OS 作为计算机资源的管理者，尤其为了协调诸多用户对系统中共享资源的使用，它还必须记录和查询各种资源的使用以及各类进程运行情况的信息，OS 对于这些信息的组织和维护也是通过建立和维护各种数据结构的方式来实现的。

### OS 中用于管理控制的数据结构

在计算机系统中，对于每个资源和每个进程都设置了一个数据结构，用于表明其实体，称之为`资源信息表`或`进程信息表`。其中包含了`资源`或`进程`的**标识、描述、状态**等信息，以及一批指针。通过这些指针可以将同类资源或进程的信息表，或者同一进程所占用的资源信息表分类链接成不同的队列。

OS 管理的这些数据结构一般分为四类：`内存表`、`设备表`、`文件表`和用于进程管理的`进程表`。

进程表又被成为进程控制块 PCB。

#### PCB 的作用

PCB 作为进程实体的一部分，记录了 OS 所需的`用于描述进程当前情况`以`及管理进程运行`全部信息，是 OS 中最终要的记录型数据结构。

PCB 的作用：使一个在多道程序环境下不能独立运行的程序成为一个能够独立运行的单位，一个能与其他进程并发执行的进程。

具体作用：

1. 作为独立运行基本单位的标志：OS 是通过 PCB 来感知进程的，PCB 已经成为进程存在于系统中的唯一标志了。
2. 能实现间断性运行方式：在多道程序环境下，当进程因阻塞而暂停运行时，此时的 CPU 现场信息都存储在 PCB 中，待到下次执行的时候通过 PCB 中的信息来恢复 CPU 现场信息。
3. 提供进程管理所需要的信息。
4. 提供进程调度所需要的信息：比如：只有处于活动就绪的进程才能被调度执行，而 PCB 中就保存了进程当前的状态信息。
5. 实现与其他进程的同步与通信：进程同步及机制是用于实现诸进程的协调运行的，采用信号量机制的时候，要求在每个进程中都设置有相应的用于同步的信号量。

#### PCB 中的信息

1. 进程标识符：
   进程通常有两种标识符： 1. 外部标识符：方便用户进程对进程的访问，通常由字母、数字组成。 2. 内部标识符(pid)：唯一的数字标识符，通常是一个进程的序号，是用于 OS 内部对进程的访问。
2. 处理机状态
   处理机状态信息又称为处理机上下文，主要是由处理机的各种寄存器中的内容组成的。
   这些寄存器包括： 1. 通用寄存器：又称为用户可是寄存器，是用户程序可以访问的，用于暂存信息，大多数处理机中有 8~32 个通用寄存器。 2. 指令计数器(PC)：存放了下一条要访问的指令的地址 3. 程序状态字(PSW)：状态信息。 4. 用户栈指针：每个用户进程都有一个或若干个相关的系统栈，用于存放过程和系统调用参数及调用地址。栈指针指向该栈的栈顶。

   > 处理机处于执行状态时，正在处理的许多信息都是放在寄存器中，当该进程被切换的时候，处理机的状态信息都必须保存在相应的 PCB 中，以便在该进程重新执行时能再从断点继续执行。

3. 进程调度信息：

   1. 进程状态
   2. 进程优先级
   3. 进程调度所需的其他信息
   4. 事件：执行=>阻塞对应的事件，即阻塞原因。

4. 进程控制信息：
   1. 程序和数据地址
   2. 进程同步和通信机制
   3. 资源清单
   4. 链接指针

### PCB 的组织方式

在一个系统中通常可有数十个~数千万个 PCB，为了能对他们加以有效的管理，应当使用适当的方式将这些 PBC 组织起来，组织方式有以下三种：

1. 线性方式：
